{"version":3,"file":"ng-image-lazy-load.umd.js.map","sources":["ng://ng-image-lazy-load/src/lazy-load.directive.ts","ng://ng-image-lazy-load/src/lazy-load.module.ts"],"sourcesContent":["import { Directive, ElementRef, AfterViewInit, OnDestroy, NgZone, PLATFORM_ID, Inject, Input } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { Subscription, fromEvent } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[appLazyLoad]'\n})\nexport class LazyLoadDirective implements AfterViewInit, OnDestroy {\n\n  private _intersectionObserver?: IntersectionObserver;\n  private _scrollSubscription?: Subscription;\n  @Input() src: string;   // The image to be lazy loaded\n\n  constructor(\n\n    private _element: ElementRef,\n    private _zone: NgZone,\n    @Inject(PLATFORM_ID) private platformId: Object\n  ) {\n  }\n\n  public ngAfterViewInit() {\n    if (isPlatformBrowser(this.platformId)) {\n      this.enableLazyLoad();\n    } else {\n      // running on server, just load the image\n      this.load();\n    }\n  }\n\n  private enableLazyLoad() {\n    // Client only code.\n    if (this.hasCompatibleBrowser()) {\n      this.registerIntersectionObserver();\n      if (this._intersectionObserver) {\n        this._intersectionObserver.observe(<Element>(this._element.nativeElement));\n      }\n    } else {\n      // add scroll watch if intersection observer is not available\n      this.addScrollListeners();\n    }\n  }\n\n  private hasCompatibleBrowser(): boolean {\n    const hasIntersectionObserver = 'IntersectionObserver' in window;\n    const userAgent = window.navigator.userAgent;\n    const matches = userAgent.match(/Edge\\/(\\d*)\\./i);\n\n    const isEdge = !!matches && matches.length > 1;\n    const isEdgeVersion16OrBetter = isEdge && (!!matches && parseInt(matches[1], 10) > 15);\n\n    return hasIntersectionObserver && (!isEdge || isEdgeVersion16OrBetter);\n  }\n\n  public ngOnDestroy() {\n    this.removeListeners();\n  }\n  private registerIntersectionObserver(): void {\n    if (!!this._intersectionObserver) {\n      return;\n    }\n    this._intersectionObserver = new IntersectionObserver(entries => {\n      this.checkForIntersection(entries);\n    }, {});\n  }\n\n  private checkForIntersection = (entries: Array<IntersectionObserverEntry>) => {\n    entries.forEach((entry: IntersectionObserverEntry) => {\n      if (this.checkIfIntersecting(entry)) {\n        this.load();\n        if (this._intersectionObserver) {\n          this._intersectionObserver.unobserve(<Element>(this._element.nativeElement));\n        }\n      }\n    });\n  }\n  private checkIfIntersecting(entry: IntersectionObserverEntry) {\n    // For Samsung native browser, IO has been partially implemented where by the\n    // callback fires, but entry object is empty. We will check manually.\n    if (entry && Object.keys(entry).length) {\n      return (<any>entry).isIntersecting && entry.target === this._element.nativeElement;\n    }\n    return this.isVisible();\n  }\n\n  private load(): void {\n    this.removeListeners();\n    // this.deferLoad.emit();\n    this._element.nativeElement.src = this.src;\n  }\n\n  private addScrollListeners() {\n    if (this.isVisible()) {\n      this.load();\n      return;\n    }\n    this._zone.runOutsideAngular(() => {\n      this._scrollSubscription = fromEvent(window, 'scroll')\n        .pipe(debounceTime(50))\n        .subscribe(this.onScroll);\n    });\n  }\n\n  private removeListeners() {\n    if (this._scrollSubscription) {\n      this._scrollSubscription.unsubscribe();\n    }\n\n    if (this._intersectionObserver) {\n      this._intersectionObserver.disconnect();\n    }\n  }\n\n  private onScroll = () => {\n    if (this.isVisible()) {\n      this._zone.run(() => this.load());\n    }\n  }\n\n  private isVisible() {\n    const scrollPosition = this.getScrollPosition();\n    const elementOffset = this._element.nativeElement.getBoundingClientRect().top;\n    return elementOffset <= scrollPosition;\n  }\n\n  private getScrollPosition() {\n    // Getting screen size and scroll position for IE\n    return (window.scrollY || window.pageYOffset)\n      + (document.documentElement.clientHeight || document.body.clientHeight);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { LazyLoadDirective } from './lazy-load.directive';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [LazyLoadDirective],\n  exports: [LazyLoadDirective]\n})\nexport class LazyLoadModule { }\n"],"names":["isPlatformBrowser","fromEvent","debounceTime","Directive","ElementRef","NgZone","Inject","PLATFORM_ID","Input","NgModule","CommonModule"],"mappings":"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"}
